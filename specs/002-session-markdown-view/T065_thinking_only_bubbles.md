# T065: å¤„ç†åªæœ‰æ€è€ƒçš„æ°”æ³¡ï¼ˆäº‘ç«¯æ€è€ƒï¼‰

**æ—¥æœŸ**: 2026-01-08  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**ä¼˜å…ˆçº§**: ä¸­

---

## é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šåœ¨ä¼šè¯ä¸­å­˜åœ¨ä¸€ç§ç‰¹æ®Šçš„æ°”æ³¡æ¶ˆæ¯,åªåŒ…å«`thinking`å­—æ®µ,æ²¡æœ‰`text`å†…å®¹å’Œå·¥å…·æ•°æ®ã€‚è¿™ç§æ°”æ³¡è¡¨ç¤ºAIåœ¨äº‘ç«¯æ€è€ƒ,ä½†æ²¡æœ‰äº§ç”Ÿå®é™…è¾“å‡ºã€‚

### çœŸå®æ•°æ®ç¤ºä¾‹

```json
{
  "_v": 3,
  "type": 2,
  "text": "",
  "thinking": {
    "signature": "2yk-V5N_OZJitFUb9G8ogKgVbi-Aq4_R6skIYvvFSfxDXHGrDgAsaUQ...",
    "text": ""
  },
  "thinkingDurationMs": 5158,
  "toolFormerData": {
    "additionalData": {
      "status": "error"
    }
  },
  "codeBlocks": [],
  "capabilities": [],
  "capabilityType": 30,
  "bubbleId": "3ca6ad5f-c157-4b59-9fa4-ca298ef49d83",
  "createdAt": "2025-12-11T10:19:00.306Z"
}
```

### å…³é”®ç‰¹å¾

| å­—æ®µ | å€¼ | è¯´æ˜ |
|:-----|:---|:-----|
| `type` | `2` | Assistantæ¶ˆæ¯ |
| `text` | `""` | æ— æ–‡æœ¬å†…å®¹ |
| `thinking` | `{signature, text}` | åŒ…å«æ€è€ƒç­¾å |
| `thinkingDurationMs` | `5158` | æ€è€ƒæ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ |
| `toolFormerData` | `{additionalData: {status: "error"}}` | å¯èƒ½åŒ…å«é”™è¯¯çŠ¶æ€ |
| `codeBlocks` | `[]` | æ— ä»£ç å— |
| `capabilities` | `[]` | æ— å·¥å…·è°ƒç”¨ |

---

## é—®é¢˜åˆ†æ

### å½“å‰è¡Œä¸º

åœ¨T056æ”¹è¿›å,ç©ºæ¶ˆæ¯ï¼ˆæ²¡æœ‰æ–‡æœ¬å’Œå·¥å…·æ•°æ®ï¼‰ä¼šè¢«æ¸²æŸ“ä¸ºç©ºå­—ç¬¦ä¸²,ä¸æ˜¾ç¤ºä»»ä½•å†…å®¹ã€‚è¿™å¯¹äºthinking-onlyæ°”æ³¡æ¥è¯´ä¸å¤Ÿå‹å¥½,ç”¨æˆ·æ— æ³•çŸ¥é“AIè¿›è¡Œäº†æ€è€ƒã€‚

### ç”¨æˆ·æœŸæœ›

ç”¨æˆ·å¸Œæœ›å¯¹äºè¿™ç§åªæœ‰æ€è€ƒçš„æ°”æ³¡,æ˜¾ç¤ºä¸€ä¸ªç®€æ´çš„æç¤º,å¦‚"æ€è€ƒxxç§’",è®©ç”¨æˆ·äº†è§£AIçš„å¤„ç†è¿‡ç¨‹ã€‚

---

## è§£å†³æ–¹æ¡ˆ

### è¯†åˆ«æ¡ä»¶

ä¸€ä¸ªæ°”æ³¡è¢«è¯†åˆ«ä¸º"thinking-only"éœ€è¦æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶:

```typescript
const isThinkingOnly = 
    !isUser &&                                    // æ˜¯Assistantæ¶ˆæ¯
    !hasText &&                                   // æ²¡æœ‰æ–‡æœ¬å†…å®¹
    !hasToolData &&                               // æ²¡æœ‰å·¥å…·æ•°æ®
    hasThinking;                                  // æœ‰thinkingå­—æ®µ
```

### æ¸²æŸ“é€»è¾‘

```typescript
// T065: å¤„ç†åªæœ‰thinkingçš„æ°”æ³¡ï¼ˆäº‘ç«¯æ€è€ƒï¼‰
const hasThinking = bubble.thinking && (bubble.thinking.text || bubble.thinking.signature);
const hasText = bubble.text && bubble.text.trim();
const isThinkingOnly = !isUser && !hasText && !hasToolData && hasThinking;

if (isThinkingOnly) {
    // è®¡ç®—æ€è€ƒæ—¶é—´
    const thinkingDurationMs = bubble.thinkingDurationMs || 0;
    const thinkingSeconds = (thinkingDurationMs / 1000).toFixed(1);
    
    // æ˜¾ç¤ºæ€è€ƒæ—¶é—´
    fragments.push(`*ğŸ’­ æ€è€ƒ ${thinkingSeconds} ç§’*`);
    
    // ç›´æ¥è¿”å›ï¼Œä¸éœ€è¦å¤„ç†å…¶ä»–å†…å®¹
    return fragments.join('\n');
}
```

### æ¸²æŸ“æ ¼å¼

```markdown
*ğŸ’­ æ€è€ƒ 5.2 ç§’*
```

**æ ¼å¼è¯´æ˜**:
- ä½¿ç”¨æ–œä½“ (`*...*`) è¡¨ç¤ºè¿™æ˜¯å…ƒä¿¡æ¯
- ä½¿ç”¨æ€è€ƒemoji (ğŸ’­) ä½œä¸ºè§†è§‰æ ‡è¯†
- æ˜¾ç¤ºæ€è€ƒæ—¶é•¿,ä¿ç•™1ä½å°æ•°
- å•ä½ä¸º"ç§’"

---

## å®ç°ç»†èŠ‚

### æ—¶é—´è®¡ç®—

```typescript
const thinkingDurationMs = bubble.thinkingDurationMs || 0;
const thinkingSeconds = (thinkingDurationMs / 1000).toFixed(1);
```

- ä»`thinkingDurationMs`å­—æ®µæå–æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
- è½¬æ¢ä¸ºç§’: `ms / 1000`
- ä¿ç•™1ä½å°æ•°: `.toFixed(1)`
- å¦‚æœå­—æ®µä¸å­˜åœ¨,é»˜è®¤ä¸º0

### æ—©æœŸè¿”å›

```typescript
if (isThinkingOnly) {
    fragments.push(`*ğŸ’­ æ€è€ƒ ${thinkingSeconds} ç§’*`);
    return fragments.join('\n');  // ç›´æ¥è¿”å›,ä¸ç»§ç»­å¤„ç†
}
```

ä½¿ç”¨æ—©æœŸè¿”å›æ¨¡å¼,é¿å…åç»­çš„æ–‡æœ¬å’Œå·¥å…·æ•°æ®å¤„ç†é€»è¾‘ã€‚

### ä¼˜å…ˆçº§

thinking-onlyæ£€æŸ¥åœ¨æ–‡æœ¬å’Œå·¥å…·æ•°æ®æ¸²æŸ“ä¹‹å‰è¿›è¡Œ,ç¡®ä¿è¿™ç±»æ°”æ³¡è¢«æ­£ç¡®è¯†åˆ«å’Œå¤„ç†ã€‚

---

## æ¸²æŸ“ç¤ºä¾‹

### ç¤ºä¾‹ 1: çŸ­æ—¶é—´æ€è€ƒ

**è¾“å…¥**:
```json
{
  "type": 2,
  "text": "",
  "thinking": {"signature": "...", "text": ""},
  "thinkingDurationMs": 1234
}
```

**è¾“å‡º**:
```markdown
*ğŸ’­ æ€è€ƒ 1.2 ç§’*
```

### ç¤ºä¾‹ 2: é•¿æ—¶é—´æ€è€ƒ

**è¾“å…¥**:
```json
{
  "type": 2,
  "text": "",
  "thinking": {"signature": "...", "text": ""},
  "thinkingDurationMs": 15678
}
```

**è¾“å‡º**:
```markdown
*ğŸ’­ æ€è€ƒ 15.7 ç§’*
```

### ç¤ºä¾‹ 3: æ€è€ƒæ—¶é—´ä¸º0

**è¾“å…¥**:
```json
{
  "type": 2,
  "text": "",
  "thinking": {"signature": "...", "text": ""},
  "thinkingDurationMs": 0
}
```

**è¾“å‡º**:
```markdown
*ğŸ’­ æ€è€ƒ 0.0 ç§’*
```

---

## è¾¹ç•Œæƒ…å†µå¤„ç†

### 1. ç¼ºå¤± thinkingDurationMs

```typescript
const thinkingDurationMs = bubble.thinkingDurationMs || 0;
```

å¦‚æœå­—æ®µä¸å­˜åœ¨,é»˜è®¤ä¸º0ç§’ã€‚

### 2. thinking å­—æ®µä¸ºç©º

```typescript
const hasThinking = bubble.thinking && (bubble.thinking.text || bubble.thinking.signature);
```

åªæœ‰å½“`thinking`å¯¹è±¡å­˜åœ¨ä¸”åŒ…å«`text`æˆ–`signature`æ—¶,æ‰è®¤ä¸ºæœ‰æ€è€ƒæ•°æ®ã€‚

### 3. åŒæ—¶æœ‰æ–‡æœ¬å’Œthinking

```typescript
const isThinkingOnly = !isUser && !hasText && !hasToolData && hasThinking;
```

å¦‚æœåŒæ—¶æœ‰æ–‡æœ¬å†…å®¹,ä¸ä¼šè¢«è¯†åˆ«ä¸ºthinking-only,ä¼šæ­£å¸¸æ¸²æŸ“æ–‡æœ¬ã€‚

### 4. åŒæ—¶æœ‰å·¥å…·æ•°æ®å’Œthinking

åŒæ ·,å¦‚æœæœ‰å·¥å…·æ•°æ®,ä¸ä¼šè¢«è¯†åˆ«ä¸ºthinking-only,ä¼šæ­£å¸¸æ¸²æŸ“å·¥å…·ä¿¡æ¯ã€‚

---

## ç”¨æˆ·ä½“éªŒæ”¹è¿›

### æ”¹è¿›å‰

thinking-onlyæ°”æ³¡è¢«æ¸²æŸ“ä¸ºç©ºå­—ç¬¦ä¸²,åœ¨Markdownä¸­ä¸æ˜¾ç¤ºä»»ä½•å†…å®¹,ç”¨æˆ·æ— æ³•æ„ŸçŸ¥AIçš„å¤„ç†è¿‡ç¨‹ã€‚

### æ”¹è¿›å

æ˜¾ç¤ºç®€æ´çš„æ€è€ƒæç¤º,ç”¨æˆ·å¯ä»¥:
1. çŸ¥é“AIè¿›è¡Œäº†æ€è€ƒ
2. äº†è§£æ€è€ƒçš„æ—¶é•¿
3. é€šè¿‡emojiå¿«é€Ÿè¯†åˆ«è¿™ç±»æ¶ˆæ¯

---

## æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹

#### ç”¨ä¾‹ 1: æ ‡å‡†thinking-onlyæ°”æ³¡
- **è¾“å…¥**: æœ‰thinking,æ— text,æ— å·¥å…·æ•°æ®,æ—¶é•¿5158ms
- **é¢„æœŸè¾“å‡º**: `*ğŸ’­ æ€è€ƒ 5.2 ç§’*`
- **çŠ¶æ€**: âœ… é€šè¿‡

#### ç”¨ä¾‹ 2: æœ‰æ–‡æœ¬çš„thinkingæ°”æ³¡
- **è¾“å…¥**: æœ‰thinking,æœ‰text,æ—¶é•¿3000ms
- **é¢„æœŸè¾“å‡º**: æ­£å¸¸æ¸²æŸ“æ–‡æœ¬,ä¸æ˜¾ç¤ºæ€è€ƒæç¤º
- **çŠ¶æ€**: âœ… é€šè¿‡

#### ç”¨ä¾‹ 3: æœ‰å·¥å…·æ•°æ®çš„thinkingæ°”æ³¡
- **è¾“å…¥**: æœ‰thinking,æœ‰toolFormerData,æ—¶é•¿2000ms
- **é¢„æœŸè¾“å‡º**: æ­£å¸¸æ¸²æŸ“å·¥å…·ä¿¡æ¯,ä¸æ˜¾ç¤ºæ€è€ƒæç¤º
- **çŠ¶æ€**: âœ… é€šè¿‡

#### ç”¨ä¾‹ 4: ç¼ºå¤±thinkingDurationMs
- **è¾“å…¥**: æœ‰thinking,æ— thinkingDurationMså­—æ®µ
- **é¢„æœŸè¾“å‡º**: `*ğŸ’­ æ€è€ƒ 0.0 ç§’*`
- **çŠ¶æ€**: âœ… é€šè¿‡

---

## å½±å“èŒƒå›´

### å—ç›ŠåŠŸèƒ½

1. **thinking-onlyæ°”æ³¡æ¸²æŸ“**: ç°åœ¨æ˜¾ç¤ºæœ‰æ„ä¹‰çš„æç¤º
2. **ç”¨æˆ·ä½“éªŒ**: ç”¨æˆ·å¯ä»¥æ„ŸçŸ¥AIçš„æ€è€ƒè¿‡ç¨‹
3. **ä¼šè¯å®Œæ•´æ€§**: ä¸å†æœ‰"æ¶ˆå¤±"çš„æ°”æ³¡

### ä¸å—å½±å“çš„åŠŸèƒ½

- æœ‰æ–‡æœ¬å†…å®¹çš„æ°”æ³¡
- æœ‰å·¥å…·æ•°æ®çš„æ°”æ³¡
- ç”¨æˆ·æ¶ˆæ¯
- å…¶ä»–ç±»å‹çš„ç©ºæ¶ˆæ¯

---

## æ–‡æ¡£æ›´æ–°

### æ›´æ–°çš„æ–‡ä»¶

1. âœ… **src/ui/markdownRenderer.ts** (lines 95-120)
   - æ·»åŠ thinking-onlyæ£€æµ‹é€»è¾‘
   - æ·»åŠ æ€è€ƒæ—¶é—´è®¡ç®—
   - æ·»åŠ æ—©æœŸè¿”å›

2. âœ… **specs/002-session-markdown-view/contracts/markdown-renderer.md**
   - æ·»åŠ "Agent æ¶ˆæ¯æ ¼å¼ï¼ˆåªæœ‰æ€è€ƒï¼Œæ— è¾“å‡ºï¼‰"ç« èŠ‚
   - æ·»åŠ æ¸²æŸ“ç¤ºä¾‹

3. âœ… **specs/002-session-markdown-view/T065_thinking_only_bubbles.md**
   - åˆ›å»ºæœ¬æ–‡æ¡£

---

## åç»­å»ºè®®

### å¯é€‰æ”¹è¿›

1. **æ€è€ƒå†…å®¹æ˜¾ç¤º**: å¦‚æœ`thinking.text`æœ‰å†…å®¹,å¯ä»¥é€‰æ‹©æ€§æ˜¾ç¤º
   ```markdown
   <details>
   <summary>ğŸ’­ æ€è€ƒ 5.2 ç§’</summary>
   
   {thinking.text}
   
   </details>
   ```

2. **æ€è€ƒé£æ ¼æ ‡è¯†**: æ ¹æ®`thinkingStyle`å­—æ®µæ˜¾ç¤ºä¸åŒçš„emojiæˆ–æ ‡ç­¾
   - `thinkingStyle: 1` â†’ ğŸ’­ (é»˜è®¤)
   - `thinkingStyle: 2` â†’ ğŸ¤” (æ·±åº¦æ€è€ƒ)

3. **é”™è¯¯çŠ¶æ€æ ‡è¯†**: å¦‚æœ`toolFormerData.additionalData.status === "error"`,æ·»åŠ é”™è¯¯æ ‡è¯†
   ```markdown
   *ğŸ’­ æ€è€ƒ 5.2 ç§’ âš ï¸ (å‡ºç°é”™è¯¯)*
   ```

4. **æ—¶é—´æ ¼å¼åŒ–**: å¯¹äºè¶…è¿‡60ç§’çš„æ€è€ƒ,æ˜¾ç¤ºä¸ºåˆ†ç§’æ ¼å¼
   - `65.3ç§’` â†’ `1åˆ†5ç§’`

---

## æ€»ç»“

æœ¬æ¬¡æ”¹è¿›è§£å†³äº†thinking-onlyæ°”æ³¡çš„æ¸²æŸ“é—®é¢˜:

âœ… **å¯è§æ€§**: ä¸å†æ˜¯ç©ºç™½,æ˜¾ç¤ºæœ‰æ„ä¹‰çš„æç¤º  
âœ… **ç®€æ´æ€§**: æ ¼å¼ç®€æ´,ä¸å¹²æ‰°é˜…è¯»  
âœ… **ä¿¡æ¯æ€§**: æ˜¾ç¤ºæ€è€ƒæ—¶é•¿,å¸®åŠ©ç”¨æˆ·ç†è§£å¤„ç†è¿‡ç¨‹  
âœ… **ä¸€è‡´æ€§**: ä¸å…¶ä»–æ¶ˆæ¯ç±»å‹ä¿æŒä¸€è‡´çš„æ¸²æŸ“é£æ ¼  
âœ… **å…¼å®¹æ€§**: ä¸å½±å“å…¶ä»–ç±»å‹çš„æ°”æ³¡æ¸²æŸ“

---

**ç›¸å…³ä»»åŠ¡**:
- T056: ç§»é™¤ç©ºæ¶ˆæ¯å ä½ç¬¦
- T059: æ”¹è¿›ç”¨æˆ·æ¶ˆæ¯æ¸²æŸ“æ ¼å¼

**å‚è€ƒèµ„æ–™**:
- `specs/002-session-markdown-view/contracts/markdown-renderer.md`
- `src/ui/markdownRenderer.ts`

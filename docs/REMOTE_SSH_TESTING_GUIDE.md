# Remote SSH 修复测试指南

## 测试目的

验证 v0.0.8 版本修复了 Remote SSH 环境下无法访问本地数据库的问题。

## 测试环境要求

### 硬件要求
- **本地机器**：Windows 10/11（存储 Cursor AI 对话记录的位置）
- **远程服务器**：任意 Linux 服务器（通过 SSH 访问）

### 软件要求
- Cursor（安装在本地 Windows）
- SSH 客户端（Cursor 内置）
- 插件版本：v0.0.8 或更高

## 测试前准备

### 1. 确认本地有 AI 对话记录

在本地 Cursor 中：
1. 打开任意项目
2. 使用 Cursor Composer (Agent 模式) 进行一次对话
3. 确认本地数据库中有记录

### 2. 设置 SSH 连接

确保能从本地 Windows SSH 连接到远程 Linux 服务器：

```bash
# 测试 SSH 连接
ssh username@remote-host
```

## 测试步骤

### 测试 1: 验证插件运行位置

**目标**：确认插件在本地运行而不是远程运行

**步骤**：
1. 在本地 Cursor 中，使用 Remote SSH 连接到远程服务器
   - `Ctrl+Shift+P` → `Remote-SSH: Connect to Host`
   - 选择或输入远程主机地址
2. 连接成功后，打开远程项目
3. 打开扩展面板（`Ctrl+Shift+X`）
4. 找到 "提示词分享助手 (Cursor Assistant)" 扩展
5. 查看扩展右侧是否显示 **"UI"** 标签

**预期结果**：
- ✅ 扩展显示 "UI" 标签（表示在本地运行）
- ❌ 如果没有标签或显示其他标签，说明配置未生效

### 测试 2: 验证能访问本地数据库

**目标**：确认插件能读取本地 Windows 的 AI 对话记录

**步骤**：
1. 在 Remote SSH 连接状态下
2. 点击左侧活动栏的 **📚 书签图标**（Cursor Assistant）
3. 查看 "Sessions" 面板

**预期结果**：
- ✅ 能看到会话列表（显示本地的 AI 对话记录）
- ❌ 如果显示"没有找到会话"或列表为空，说明无法访问本地数据库

### 测试 3: 验证诊断命令

**目标**：确认诊断工具显示正确的路径信息

**步骤**：
1. 在 Remote SSH 连接状态下
2. 打开命令面板（`Ctrl+Shift+P`）
3. 输入 `Cursor Assistant: 诊断工作空间路径`
4. 查看输出信息

**预期结果**：
```
平台信息: win32  ← 应该显示本地 Windows 平台
用户数据目录: C:\Users\YourName\AppData\Roaming\Cursor\User  ← 本地路径
```

**错误示例**（修复前）：
```
平台信息: linux  ← 错误：显示远程 Linux 平台
用户数据目录: /home/username/.config/Cursor/User  ← 错误：远程路径
```

### 测试 4: 验证上传功能

**目标**：确认能正常上传和分享对话记录

**前提**：已登录插件

**步骤**：
1. 在 Remote SSH 连接状态下
2. 在 Sessions 面板选择一个会话
3. 右键点击，选择"分享"
4. 填写表单，提交上传

**预期结果**：
- ✅ 上传成功，获得分享链接
- ✅ 能在浏览器中打开分享链接查看内容

### 测试 5: 多环境切换测试

**目标**：验证在不同环境间切换时插件工作正常

**步骤**：
1. 从 Remote SSH 断开连接
2. 在本地打开一个项目
3. 确认 Sessions 面板正常显示
4. 重新连接 Remote SSH
5. 再次确认 Sessions 面板正常显示

**预期结果**：
- ✅ 本地和远程环境都能看到相同的会话列表
- ✅ 切换环境时不会出现错误

## 测试对比

### 修复前（v0.0.7 及之前）

| 环境 | 插件运行位置 | 能否访问数据库 | Sessions 面板 |
|------|-------------|--------------|--------------|
| 本地开发 | 本地 | ✅ 能 | ✅ 正常显示 |
| Remote SSH | 远程 | ❌ 不能 | ❌ 为空或报错 |

### 修复后（v0.0.8）

| 环境 | 插件运行位置 | 能否访问数据库 | Sessions 面板 |
|------|-------------|--------------|--------------|
| 本地开发 | 本地 | ✅ 能 | ✅ 正常显示 |
| Remote SSH | **本地** | ✅ 能 | ✅ 正常显示 |

## 常见问题

### Q1: 升级后插件还是不工作？

**可能原因**：VSCode/Cursor 可能缓存了旧版本的扩展配置

**解决方法**：
1. 完全关闭 Cursor
2. 重新打开 Cursor
3. 重新连接 Remote SSH
4. 检查扩展是否显示 "UI" 标签

### Q2: 扩展没有显示 "UI" 标签？

**检查步骤**：
1. 确认插件版本是 v0.0.8 或更高
2. 查看 `package.json` 中是否有：
   ```json
   "extensionKind": ["ui"]
   ```
3. 尝试重新安装插件

### Q3: 诊断命令显示远程路径？

**问题**：说明插件仍在远程运行

**解决方法**：
1. 卸载插件
2. 完全关闭 Cursor
3. 重新安装 v0.0.8 版本
4. 重启 Cursor

## 回归测试

确保修复没有影响其他功能：

- [ ] 本地开发环境下插件正常工作
- [ ] Mac 环境下插件正常工作（如果有 Mac 测试环境）
- [ ] WSL 环境下插件正常工作（如果有 WSL）
- [ ] 登录功能正常
- [ ] 上传功能正常
- [ ] 会话列表正常显示
- [ ] Markdown 预览正常

## 测试报告模板

```markdown
## Remote SSH 测试报告

**测试人员**: [姓名]
**测试日期**: [日期]
**插件版本**: v0.0.8
**环境信息**:
- 本地系统: Windows 10/11
- 远程系统: [Linux 发行版]
- Cursor 版本: [版本号]

### 测试结果

| 测试项 | 结果 | 备注 |
|--------|------|------|
| 插件运行位置 | ✅/❌ | |
| 访问本地数据库 | ✅/❌ | |
| 诊断命令 | ✅/❌ | |
| 上传功能 | ✅/❌ | |
| 环境切换 | ✅/❌ | |

### 发现的问题

1. [问题描述]
   - 复现步骤：
   - 预期结果：
   - 实际结果：

### 总结

[测试通过/失败，需要修复的问题等]
```

## 参考文档

- [Remote SSH 支持说明](./REMOTE_SSH_SUPPORT.md)
- [VSCode Remote Extensions Guide](https://code.visualstudio.com/api/advanced-topics/remote-extensions)
